var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,i=(e,i)=>{for(var l in i||(i={}))n.call(i,l)&&o(e,l,i[l]);if(t)for(var l of t(i))a.call(i,l)&&o(e,l,i[l]);return e},l=(e,t,n)=>new Promise(((a,o)=>{var i=e=>{try{r(n.next(e))}catch(t){o(t)}},l=e=>{try{r(n.throw(e))}catch(t){o(t)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,l);r((n=n.apply(e,t)).next())}));window.CESIUM_BASE_URL="cesium/";import{r,o as s,c,w as d,_ as u,a as p,C as h,u as m,h as g,d as f,b as y,e as v,f as C,g as w,i as E,j as I,k as b,t as M,l as S,F as L,m as T,L as R,n as O,p as _,B as P,q as k,s as A,v as D,x as V,y as x,z as H,A as U,S as N,D as F,E as G,G as W,H as B,I as z,J as K}from"./vendor.e5b6296c.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var j=(e,t)=>{const n=e.__vccOpts||e;for(const[a,o]of t)n[a]=o;return n};var J=j({},[["render",function(e,t){const n=r("router-view"),a=u;return s(),c(a,null,{default:d((()=>[p(n)])),_:1})}]]);function q(){return i({},h)}const Z=q();function Y(e){const t={};e.cesiumWidget.screenSpaceEventHandler.removeInputAction(Z.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t.handler=new Z.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);const n=[];let a=null,o=0,i=null;t.handler.setInputAction((function(t){const r=e.camera.getPickRay(t.endPosition);i=e.scene.globe.pick(r,e.scene),n.length>=2&&(Z.defined(a)?(n.pop(),n.push(i)):a=new l(n),o=function(e){let t=0;for(let n=0;n<e.length-1;n++){const a=Z.Cartographic.fromCartesian(e[n]),o=Z.Cartographic.fromCartesian(e[n+1]),i=new Z.EllipsoidGeodesic;i.setEndPoints(a,o);let l=i.surfaceDistance;l=Math.sqrt(Math.pow(l,2)+Math.pow(o.height-a.height,2)),t+=l}return Number(t.toFixed(2))}(n))}),Z.ScreenSpaceEventType.MOUSE_MOVE),t.handler.setInputAction((function(a){const l=e.camera.getPickRay(a.position);i=e.scene.globe.pick(l,e.scene),0==n.length&&n.push(i.clone()),n.push(i);const r=o+"米";t.floatingPoint=e.entities.add({name:"空间直线距离",position:n[n.length-1],point:{pixelSize:4,color:Z.Color.RED,outlineColor:Z.Color.WHITE,outlineWidth:2},label:{text:r,font:"18px sans-serif",fillColor:Z.Color.GOLD,style:Z.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:Z.VerticalOrigin.BOTTOM,pixelOffset:new Z.Cartesian2(20,-20)}})}),Z.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(){t.handler.destroy(),n.pop()}),Z.ScreenSpaceEventType.RIGHT_CLICK);const l=function(n){t.options={id:"distancePolyline",name:"直线",polyline:{show:!0,positions:[],material:Z.Color.CHARTREUSE,width:2,clampToGround:!0}},t.positions=n,t.options.polyline.positions=new Z.CallbackProperty((function(){return t.positions}),!1),e.entities.add(t.options)}}const X=q();function $(e){const t={};e.cesiumWidget.screenSpaceEventHandler.removeInputAction(X.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t.handler=new X.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);const n=[],a=[];let o=null,i=null,l=null;const r=[];let s;t.handler.setInputAction((function(t){const a=e.camera.getPickRay(t.endPosition);l=e.scene.globe.pick(a,e.scene),n.length>=2&&(X.defined(o)?(n.pop(),n.push(l)):o=new h(n))}),X.ScreenSpaceEventType.MOUSE_MOVE),t.handler.setInputAction((function(o){const i=e.camera.getPickRay(o.position);l=e.scene.globe.pick(i,e.scene),0==n.length&&n.push(l.clone()),n.push(l);const c=X.Cartographic.fromCartesian(n[n.length-1]),d=X.Math.toDegrees(c.longitude),u=X.Math.toDegrees(c.latitude),p=c.height;a.push({lon:d,lat:u,hei:p}),s=e.entities.add({name:"多边形面积",position:n[n.length-1],point:{pixelSize:5,color:X.Color.RED,outlineColor:X.Color.WHITE,outlineWidth:2,heightReference:X.HeightReference.CLAMP_TO_GROUND}}),r.push(s),t.areapointArray=r}),X.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(){t.handler.destroy(),n.pop();const o=function(e){let t=0;for(let a=0;a<e.length-2;a++){const o=(a+1)%e.length,i=(a+2)%e.length,l=u(e[a],e[o],e[i]);t+=m(n[a],n[o])*m(n[o],n[i])*Math.abs(Math.sin(l))}return(t/1e6).toFixed(4)}(a)+"平方公里";i=e.entities.add({name:"多边形面积",position:n[n.length-1],point:{pixelSize:5,color:X.Color.RED,outlineColor:X.Color.WHITE,outlineWidth:2,heightReference:X.HeightReference.CLAMP_TO_GROUND},label:{text:o,font:"18px sans-serif",fillColor:X.Color.GOLD,style:X.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:X.VerticalOrigin.BOTTOM,pixelOffset:new X.Cartesian2(20,-40),heightReference:X.HeightReference.CLAMP_TO_GROUND}}),r.push(i),t.areapointArray=r}),X.ScreenSpaceEventType.RIGHT_CLICK);const c=Math.PI/180,d=180/Math.PI;function u(e,t,n){let a=p(t,e)-p(t,n);return a<0&&(a+=360),a}function p(e,t){const n=e.lat*c,a=e.lon*c,o=t.lat*c,i=t.lon*c;let l=-Math.atan2(Math.sin(a-i)*Math.cos(o),Math.cos(n)*Math.sin(o)-Math.sin(n)*Math.cos(o)*Math.cos(a-i));return l<0&&(l+=2*Math.PI),l*=d,l}const h=function(n){t.options={id:"areaPolygon",name:"多边形",polygon:{hierarchy:[],material:X.Color.GREEN.withAlpha(.5),heightReference:2e4}},t.hierarchy={positions:n},t.options.polygon.hierarchy=new X.CallbackProperty((function(){return t.hierarchy}),!1),e.entities.add(t.options)};function m(e,t){const n=X.Cartographic.fromCartesian(e),a=X.Cartographic.fromCartesian(t),o=new X.EllipsoidGeodesic;o.setEndPoints(n,a);let i=o.surfaceDistance;return i=Math.sqrt(Math.pow(i,2)+Math.pow(a.height-n.height,2)),i}}const Q=q();function ee(e,t){const n=m([]);let a=m(null),o=m(null);e.scene.globe.depthTestAgainstTerrain=!0,e.cesiumWidget.screenSpaceEventHandler.removeInputAction(Q.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);const i=new Q.ScreenSpaceEventHandler(e.canvas),l=t=>e.entities.add({name:"点",position:t,point:{color:Q.Color.WHITE,pixelSize:10,outlineColor:Q.Color.YELLOW,outlineWidth:3,disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:Q.HeightReference.CLAMP_TO_GROUND}}),r=n=>{let a=null;switch(t){case"polyline":return o=n,a=e.entities.add({name:"线",polyline:{positions:o,clampToGround:!0,width:5}}),a;case"polygon":return a=(t=>e.entities.add({name:"面",polygon:{hierarchy:t,material:new Q.ColorMaterialProperty(Q.Color.WHITE.withAlpha(.7))}}))(n),a;default:return a}var o};i.setInputAction((function(i){const s=e.camera.getPickRay(i.position),c=e.scene.globe.pick(s,e.scene);if(0===n.length){o=l(c),n.push(c);const e=new Q.CallbackProperty((function(){return"polygon"===t?new Q.PolygonHierarchy(n):n}),!1);a=r(e)}l(c),n.push(c)}),Q.ScreenSpaceEventType.LEFT_CLICK),i.setInputAction((function(t){if(Q.defined(o)){const a=e.scene.pickPosition(t.endPosition);Q.defined(a)&&(o.position.setValue(a),n.pop(),n.push(a))}}),Q.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction((function(){s()}),Q.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);const s=()=>{i.destroy(),n.pop(),n.length&&r(n),e.entities.remove(o),e.entities.remove(a),o=null,a=null};i.setInputAction((function(){s()}),Q.ScreenSpaceEventType.RIGHT_CLICK)}const te=q();const ne=q();const ae={key:1,class:"panel"},oe={class:"panel-header"},ie={class:"content"},le={class:"item-header"},re={class:"content-wrap"};var se=j(f({props:{title:{type:String,default:"菜单操作"},width:{type:String,default:"30%"},visible:{type:Boolean,default:!1}},emits:["update:visible","on-click"],setup(e,{emit:t}){const n=e,a=y([{label:"量测",list:[{label:"线距",value:"line"},{label:"面积",value:"area"}]},{label:"绘制",list:[{label:"点",value:"point"},{label:"线",value:"polyline"},{label:"面",value:"polygon"},{label:"清除",value:"clear"}]},{label:"图层",list:[{label:"热力图",value:"heatmap"},{label:"清空热力图",value:"clearHeatmap"}]}]),{removeAllDraw:o}={removeEntities:(e,t)=>{let n=new te.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);if(n&&(n.destroy(),n=null),t&&Array.isArray(t))for(let a=0;a<t.length;a++)e.entities.remove(t[a])},removePrimitives:e=>{e.scene.primitives.removeAll()},removeAllDraw:(e,t=["点","线","面"])=>{const n=e.entities._entities._array;for(let a=n.length-1;a>=0;a--)n[a]._name&&t.includes(n[a]._name)&&e.entities.remove(n[a])}},{createRectangle:i,getRandomData:l,createHeatMap:r}={createRectangle:(e,t,n)=>{e.entities.add({name:"热力图",show:!0,rectangle:{coordinates:ne.Rectangle.fromDegrees(t[0],t[1],t[2],t[3]),material:n._renderer.canvas,transparent:!0}}),e.zoomTo(e.entities)},getRandomData:e=>{const t=[];let n=0;for(;e--;){const e=Math.floor(100*Math.random());n=Math.max(n,e);const a={x:Math.floor(840*Math.random()),y:Math.floor(400*Math.random()),value:e};t.push(a)}return{max:n,data:t}},createHeatMap:(e,t)=>{const n=document.createElement("div");n.setAttribute("style","width: 100px; height: 100px; margin: 0px; display: none;"),document.body.appendChild(n);const a=g.create({container:n,radius:5,maxOpacity:.5,minOpacity:0,gradient:{.9:"red",.8:"orange",.7:"yellow",.5:"blue",.3:"green"}});return a.setData({max:e,data:t}),a}},u=v(!1),h=v(""),f=v(null);C((()=>{u.value=n.visible}));const A=w((()=>u.value?180:0)),D=()=>{u.value=!u.value,t("update:visible",u.value)};return(e,g)=>{const y=P,v=k;return s(),E("div",{class:O(["panel-wrap",{hide:!u.value}])},[e.$slots.default?I(e.$slots,"default",{key:0},void 0,!0):(s(),E("div",ae,[b("header",oe,[b("span",null,M(n.title),1),p(m(S),{onClick:D,class:"close-btn"})]),b("div",ie,[(s(!0),E(L,null,T(m(a),((e,n)=>(s(),E("div",{key:n,class:"content-item"},[b("header",le,M(e.label),1),b("div",re,[p(v,null,{default:d((()=>[(s(!0),E(L,null,T(e.list,((e,n)=>(s(),c(y,{size:"small",type:h.value===e.value?"primary":"default",key:n,onClick:n=>(e=>{switch(h.value=e,e){case"line":Y(window.CViewer);break;case"area":$(window.CViewer);break;case"point":case"polyline":case"polygon":ee(window.CViewer,e);break;case"clear":o(window.CViewer),h.value="";break;case"heatmap":const t=[80,22,130,50],{max:n,data:a}=l(200);f.value=r(n,a),i(window.CViewer,t,f.value);break;case"clearHeatmap":o(window.CViewer,["热力图"])}t("on-click",e)})(e.value)},{default:d((()=>[_(M(e.label),1)])),_:2},1032,["type","onClick"])))),128))])),_:2},1024)])])))),128))])])),b("aside",{class:"bar-icon",onClick:D},[p(m(R),{rotate:m(A)},null,8,["rotate"])])],2)}}}),[["__scopeId","data-v-5cf6669b"]]);const ce=A();const de=D({id:"app",state:()=>({pageLoading:!0}),getters:{getPageLoading(){return this.pageLoading}},actions:{setPageLoading(e){this.pageLoading=e}}}),ue=q();const pe={id:"cesium3DContainer",class:"cesium-3d-container"};var he=j(f({props:{modelValue:{type:String,default:"osm"}},emits:["mapReady","select","update:modelValue"],setup(e,{emit:t}){const n=e,a=v([{value:"base",label:"3D map"},{value:"osm",label:"OSM Building"},{value:"tile",label:"3D Tiles"}]),o=de(),r=w((()=>o.getPageLoading));x((()=>l(this,null,(function*(){yield function(e="cesium3DContainer",t){V.start(),ue.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZjgwM2VkMy0wOTQxLTRlMDQtOTA3NC02ZDJhNmFlYWI2M2MiLCJpZCI6OTMyNzEsImlhdCI6MTY1MzYxNTc3MX0.PZXaawvZhCgcahjwZFrmfXRtzvgF5_Vq7S1RtHO0sE8",ue.Camera.DEFAULT_VIEW_RECTANGLE=ue.Rectangle.fromDegrees(80,22,130,50);const n=new ue.Viewer(e,i(i({},{selectionIndicator:!1,showRenderLoopErrors:!1,baseLayerPicker:!1,navigationHelpButton:!1,animation:!1,timeline:!1,shadows:!1,shouldAnimate:!0,infoBox:!1,fullscreenButton:!1,homeButton:!0,geocoder:!1,sceneModePicker:!0,requestRenderMode:!0,scene3DOnly:!1,sceneMode:3}),t));n.imageryLayers.addImageryProvider(new ue.IonImageryProvider({assetId:3})),n.scene.globe.enableLighting=!0,n.scene.debugShowFramesPerSecond=!1,n.camera.setView({destination:ue.Cartesian3.fromDegrees(104,30,1e7),orientation:{heading:ue.Math.toRadians(0),pitch:ue.Math.toRadians(-90),roll:0}}),n.clock.shouldAnimate=!0,window.CViewer=n;const a=de();(new ue.EventHelper).add(n.scene.globe.tileLoadProgressEvent,(e=>{(e>20||0===e)&&(V.done(),a.setPageLoading(!1))}))}(),t("mapReady")}))));const u=w((()=>n.modelValue)),h=e=>{t("select",e),t("update:modelValue",e)};return(e,t)=>{const n=U,o=N;return s(),c(o,{spinning:m(r),size:"large"},{default:d((()=>[b("div",pe,[p(n,{class:"map-select",value:m(u),"onUpdate:value":t[0]||(t[0]=e=>H(u)?u.value=e:null),options:a.value,onChange:h},null,8,["value","options"]),I(e.$slots,"default",{},void 0,!0)])])),_:3},8,["spinning"])}}}),[["__scopeId","data-v-3dd34448"]]);function me(e){const t=q(),n=()=>{if(!e||e.scene.mode!==t.SceneMode.SCENE3D)return!1;const n=t.Transforms.computeIcrfToFixedMatrix(e.clock.currentTime);if(t.defined(n)){const a=t.Cartesian3.clone(e.camera.position),o=t.Matrix4.fromRotationTranslation(n);e.camera.lookAtTransform(o,a)}};return{startRotate:t=>{if(e.scene.postUpdate.addEventListener(n),e.clock){const n=Object.keys(t);for(const a of n)e.clock[a]=t[a]}},stopRotate:()=>{e.clock.multiplier=1,e.scene.postUpdate.removeEventListener(n)}}}const ge=[{path:"/",name:"base",component:f({setup(e){const t=F(),n=v("base"),a=v(!1),o=e=>{t.push({name:e})},i=()=>{const{startRotate:e}=me(window.CViewer);e({multiplier:300})};return G((()=>{const{stopRotate:e}=me(window.CViewer);e()})),(e,t)=>{const l=he,r=se;return s(),E(L,null,[p(l,{onSelect:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),onMapReady:i},null,8,["modelValue"]),p(r,{visible:a.value,"onUpdate:visible":t[1]||(t[1]=e=>a.value=e)},null,8,["visible"])],64)}}})},{path:"/osm",name:"osm",component:f({setup(e){const t=F(),n=v("osm"),a=e=>{t.push({name:e})},o=()=>{!function(e){const t=q();e.imageryLayers.addImageryProvider(new t.IonImageryProvider({assetId:3})),e.scene.primitives.add(t.createOsmBuildings()),e.scene.camera.flyTo({destination:t.Cartesian3.fromDegrees(-74.019,40.6912,750),orientation:{heading:t.Math.toRadians(20),pitch:t.Math.toRadians(-20)}})}(window.CViewer)};return(e,t)=>{const i=he;return s(),c(i,{onSelect:a,onMapReady:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},null,8,["modelValue"])}}})},{path:"/3d-tiles",name:"tile",component:f({setup(e){const t=F(),n=v("tile"),a=e=>{t.push({name:e})},o=()=>{!function(e){l(this,null,(function*(){const t=q();e.imageryLayers.addImageryProvider(new t.IonImageryProvider({assetId:3}));const n=new t.Cesium3DTileset({url:t.IonResource.fromAssetId(354759)});e.scene.primitives.add(n);try{yield n.readyPromise,yield e.zoomTo(n);const a=n.asset.extras;t.defined(a)&&t.defined(a.ion)&&t.defined(a.ion.defaultStyle)&&(n.style=new t.Cesium3DTileStyle(a.ion.defaultStyle))}catch(a){}}))}(window.CViewer)};return(e,t)=>{const i=he;return s(),c(i,{onSelect:a,onMapReady:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},null,8,["modelValue"])}}})}],fe=W({history:B(),routes:ge}),ye=z(J);ye.use(fe).use(A()).mount("#app"),ye.use(ce),ye.config.globalProperties.$message=K;
