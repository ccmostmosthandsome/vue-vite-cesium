var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,i=(e,i)=>{for(var l in i||(i={}))n.call(i,l)&&o(e,l,i[l]);if(t)for(var l of t(i))a.call(i,l)&&o(e,l,i[l]);return e},l=(e,t,n)=>new Promise(((a,o)=>{var i=e=>{try{r(n.next(e))}catch(t){o(t)}},l=e=>{try{r(n.throw(e))}catch(t){o(t)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,l);r((n=n.apply(e,t)).next())}));window.CESIUM_BASE_URL="cesium/";import{c as r,d as s,a as c,b as d,r as u,e as p,w as h,_ as m,o as g,f,u as y,S as v,C,h as w,g as E,i as I,j as b,k as M,l as S,m as T,t as L,n as R,F as O,p as _,L as P,q as k,s as A,B as D,v as V,x,y as H,z as U,A as N,D as F,E as G,G as W,H as B,I as z,J as K}from"./vendor.8b777ee4.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const j=r();const J=s({id:"app",state:()=>({pageLoading:!1}),getters:{getPageLoading(){return this.pageLoading}},actions:{setPageLoading(e){this.pageLoading=e}}});const q=c({setup(e){const t=J(),n=d((()=>t.getPageLoading));return(e,t)=>{const a=u("router-view"),o=v,i=m;return g(),p(i,null,{default:h((()=>[f(o,{spinning:y(n),tip:"加载中...",size:"large"},{default:h((()=>[f(a)])),_:1},8,["spinning"])])),_:1})}}});function Z(){return i({},C)}const Y=Z();function X(e){const t={};e.cesiumWidget.screenSpaceEventHandler.removeInputAction(Y.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t.handler=new Y.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);const n=[];let a=null,o=0,i=null;t.handler.setInputAction((function(t){const r=e.camera.getPickRay(t.endPosition);i=e.scene.globe.pick(r,e.scene),n.length>=2&&(Y.defined(a)?(n.pop(),n.push(i)):a=new l(n),o=function(e){let t=0;for(let n=0;n<e.length-1;n++){const a=Y.Cartographic.fromCartesian(e[n]),o=Y.Cartographic.fromCartesian(e[n+1]),i=new Y.EllipsoidGeodesic;i.setEndPoints(a,o);let l=i.surfaceDistance;l=Math.sqrt(Math.pow(l,2)+Math.pow(o.height-a.height,2)),t+=l}return Number(t.toFixed(2))}(n))}),Y.ScreenSpaceEventType.MOUSE_MOVE),t.handler.setInputAction((function(a){const l=e.camera.getPickRay(a.position);i=e.scene.globe.pick(l,e.scene),0==n.length&&n.push(i.clone()),n.push(i);const r=o+"米";t.floatingPoint=e.entities.add({name:"空间直线距离",position:n[n.length-1],point:{pixelSize:4,color:Y.Color.RED,outlineColor:Y.Color.WHITE,outlineWidth:2},label:{text:r,font:"18px sans-serif",fillColor:Y.Color.GOLD,style:Y.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:Y.VerticalOrigin.BOTTOM,pixelOffset:new Y.Cartesian2(20,-20)}})}),Y.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(){t.handler.destroy(),n.pop()}),Y.ScreenSpaceEventType.RIGHT_CLICK);const l=function(n){t.options={id:"distancePolyline",name:"直线",polyline:{show:!0,positions:[],material:Y.Color.CHARTREUSE,width:2,clampToGround:!0}},t.positions=n,t.options.polyline.positions=new Y.CallbackProperty((function(){return t.positions}),!1),e.entities.add(t.options)}}const $=Z();function Q(e){const t={};e.cesiumWidget.screenSpaceEventHandler.removeInputAction($.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t.handler=new $.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);const n=[],a=[];let o=null,i=null,l=null;const r=[];let s;t.handler.setInputAction((function(t){const a=e.camera.getPickRay(t.endPosition);l=e.scene.globe.pick(a,e.scene),n.length>=2&&($.defined(o)?(n.pop(),n.push(l)):o=new h(n))}),$.ScreenSpaceEventType.MOUSE_MOVE),t.handler.setInputAction((function(o){const i=e.camera.getPickRay(o.position);l=e.scene.globe.pick(i,e.scene),0==n.length&&n.push(l.clone()),n.push(l);const c=$.Cartographic.fromCartesian(n[n.length-1]),d=$.Math.toDegrees(c.longitude),u=$.Math.toDegrees(c.latitude),p=c.height;a.push({lon:d,lat:u,hei:p}),s=e.entities.add({name:"多边形面积",position:n[n.length-1],point:{pixelSize:5,color:$.Color.RED,outlineColor:$.Color.WHITE,outlineWidth:2,heightReference:$.HeightReference.CLAMP_TO_GROUND}}),r.push(s),t.areapointArray=r}),$.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(){t.handler.destroy(),n.pop();const o=function(e){let t=0;for(let a=0;a<e.length-2;a++){const o=(a+1)%e.length,i=(a+2)%e.length,l=u(e[a],e[o],e[i]);t+=m(n[a],n[o])*m(n[o],n[i])*Math.abs(Math.sin(l))}return(t/1e6).toFixed(4)}(a)+"平方公里";i=e.entities.add({name:"多边形面积",position:n[n.length-1],point:{pixelSize:5,color:$.Color.RED,outlineColor:$.Color.WHITE,outlineWidth:2,heightReference:$.HeightReference.CLAMP_TO_GROUND},label:{text:o,font:"18px sans-serif",fillColor:$.Color.GOLD,style:$.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:$.VerticalOrigin.BOTTOM,pixelOffset:new $.Cartesian2(20,-40),heightReference:$.HeightReference.CLAMP_TO_GROUND}}),r.push(i),t.areapointArray=r}),$.ScreenSpaceEventType.RIGHT_CLICK);const c=Math.PI/180,d=180/Math.PI;function u(e,t,n){let a=p(t,e)-p(t,n);return a<0&&(a+=360),a}function p(e,t){const n=e.lat*c,a=e.lon*c,o=t.lat*c,i=t.lon*c;let l=-Math.atan2(Math.sin(a-i)*Math.cos(o),Math.cos(n)*Math.sin(o)-Math.sin(n)*Math.cos(o)*Math.cos(a-i));return l<0&&(l+=2*Math.PI),l*=d,l}const h=function(n){t.options={id:"areaPolygon",name:"多边形",polygon:{hierarchy:[],material:$.Color.GREEN.withAlpha(.5),heightReference:2e4}},t.hierarchy={positions:n},t.options.polygon.hierarchy=new $.CallbackProperty((function(){return t.hierarchy}),!1),e.entities.add(t.options)};function m(e,t){const n=$.Cartographic.fromCartesian(e),a=$.Cartographic.fromCartesian(t),o=new $.EllipsoidGeodesic;o.setEndPoints(n,a);let i=o.surfaceDistance;return i=Math.sqrt(Math.pow(i,2)+Math.pow(a.height-n.height,2)),i}}const ee=Z();function te(e,t){const n=y([]);let a=y(null),o=y(null);e.scene.globe.depthTestAgainstTerrain=!0,e.cesiumWidget.screenSpaceEventHandler.removeInputAction(ee.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);const i=new ee.ScreenSpaceEventHandler(e.canvas),l=t=>e.entities.add({name:"点",position:t,point:{color:ee.Color.WHITE,pixelSize:10,outlineColor:ee.Color.YELLOW,outlineWidth:3,disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:ee.HeightReference.CLAMP_TO_GROUND}}),r=n=>{let a=null;switch(t){case"polyline":return o=n,a=e.entities.add({name:"线",polyline:{positions:o,clampToGround:!0,width:5}}),a;case"polygon":return a=(t=>e.entities.add({name:"面",polygon:{hierarchy:t,material:new ee.ColorMaterialProperty(ee.Color.WHITE.withAlpha(.7))}}))(n),a;default:return a}var o};i.setInputAction((function(i){const s=e.camera.getPickRay(i.position),c=e.scene.globe.pick(s,e.scene);if(0===n.length){o=l(c),n.push(c);const e=new ee.CallbackProperty((function(){return"polygon"===t?new ee.PolygonHierarchy(n):n}),!1);a=r(e)}l(c),n.push(c)}),ee.ScreenSpaceEventType.LEFT_CLICK),i.setInputAction((function(t){if(ee.defined(o)){const a=e.scene.pickPosition(t.endPosition);ee.defined(a)&&(o.position.setValue(a),n.pop(),n.push(a))}}),ee.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction((function(){s()}),ee.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);const s=()=>{i.destroy(),n.pop(),n.length&&r(n),e.entities.remove(o),e.entities.remove(a),o=null,a=null};i.setInputAction((function(){s()}),ee.ScreenSpaceEventType.RIGHT_CLICK)}const ne=Z();const ae=Z();var oe=(e,t)=>{const n=e.__vccOpts||e;for(const[a,o]of t)n[a]=o;return n};const ie={key:1,class:"panel"},le={class:"panel-header"},re={class:"content"},se={class:"item-header"},ce={class:"content-wrap"};var de=oe(c({props:{title:{type:String,default:"菜单操作"},width:{type:String,default:"30%"},visible:{type:Boolean,default:!1}},emits:["update:visible","on-click"],setup(e,{emit:t}){const n=e,a=E([{label:"量测",list:[{label:"线距",value:"line"},{label:"面积",value:"area"}]},{label:"绘制",list:[{label:"点",value:"point"},{label:"线",value:"polyline"},{label:"面",value:"polygon"},{label:"清除",value:"clear"}]},{label:"图层",list:[{label:"热力图",value:"heatmap"},{label:"清空热力图",value:"clearHeatmap"}]}]),{removeAllDraw:o}={removeEntities:(e,t)=>{let n=new ne.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);if(n&&(n.destroy(),n=null),t&&Array.isArray(t))for(let a=0;a<t.length;a++)e.entities.remove(t[a])},removePrimitives:e=>{e.scene.primitives.removeAll()},removeAllDraw:(e,t=["点","线","面"])=>{const n=e.entities._entities._array;for(let a=n.length-1;a>=0;a--)n[a]._name&&t.includes(n[a]._name)&&e.entities.remove(n[a])}},{createRectangle:i,getRandomData:l,createHeatMap:r}={createRectangle:(e,t,n)=>{e.entities.add({name:"热力图",show:!0,rectangle:{coordinates:ae.Rectangle.fromDegrees(t[0],t[1],t[2],t[3]),material:n._renderer.canvas,transparent:!0}}),e.zoomTo(e.entities)},getRandomData:e=>{const t=[];let n=0;for(;e--;){const e=Math.floor(100*Math.random());n=Math.max(n,e);const a={x:Math.floor(840*Math.random()),y:Math.floor(400*Math.random()),value:e};t.push(a)}return{max:n,data:t}},createHeatMap:(e,t)=>{const n=document.createElement("div");n.setAttribute("style","width: 100px; height: 100px; margin: 0px; display: none;"),document.body.appendChild(n);const a=w.create({container:n,radius:5,maxOpacity:.5,minOpacity:0,gradient:{.9:"red",.8:"orange",.7:"yellow",.5:"blue",.3:"green"}});return a.setData({max:e,data:t}),a}},s=I(!1),c=I(""),u=I(null);b((()=>{s.value=n.visible}));const m=d((()=>s.value?180:0)),v=()=>{s.value=!s.value,t("update:visible",s.value)};return(e,d)=>{const C=D,w=V;return g(),M("div",{class:k(["panel-wrap",{hide:!s.value}])},[e.$slots.default?S(e.$slots,"default",{key:0},void 0,!0):(g(),M("div",ie,[T("header",le,[T("span",null,L(n.title),1),f(y(R),{onClick:v,class:"close-btn"})]),T("div",re,[(g(!0),M(O,null,_(y(a),((e,n)=>(g(),M("div",{key:n,class:"content-item"},[T("header",se,L(e.label),1),T("div",ce,[f(w,null,{default:h((()=>[(g(!0),M(O,null,_(e.list,((e,n)=>(g(),p(C,{size:"small",type:c.value===e.value?"primary":"default",key:n,onClick:n=>(e=>{switch(c.value=e,e){case"line":X(window.CViewer);break;case"area":Q(window.CViewer);break;case"point":case"polyline":case"polygon":te(window.CViewer,e);break;case"clear":o(window.CViewer),c.value="";break;case"heatmap":const t=[80,22,130,50],{max:n,data:a}=l(200);u.value=r(n,a),i(window.CViewer,t,u.value);break;case"clearHeatmap":o(window.CViewer,["热力图"])}t("on-click",e)})(e.value)},{default:h((()=>[A(L(e.label),1)])),_:2},1032,["type","onClick"])))),128))])),_:2},1024)])])))),128))])])),T("aside",{class:"bar-icon",onClick:v},[f(y(P),{rotate:y(m)},null,8,["rotate"])])],2)}}}),[["__scopeId","data-v-5cf6669b"]]);const ue=Z();const pe={id:"cesium3DContainer",class:"cesium-3d-container"};var he=oe(c({props:{modelValue:{type:String,default:"osm"}},emits:["mapReady","select","update:modelValue"],setup(e,{emit:t}){const n=e,a=I([{value:"base",label:"3D map"},{value:"osm",label:"OSM Building"},{value:"tile",label:"3D Tiles"}]);H((()=>l(this,null,(function*(){yield function(e="cesium3DContainer",t){x.start(),ue.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZjgwM2VkMy0wOTQxLTRlMDQtOTA3NC02ZDJhNmFlYWI2M2MiLCJpZCI6OTMyNzEsImlhdCI6MTY1MzYxNTc3MX0.PZXaawvZhCgcahjwZFrmfXRtzvgF5_Vq7S1RtHO0sE8",ue.Camera.DEFAULT_VIEW_RECTANGLE=ue.Rectangle.fromDegrees(80,22,130,50);const n=new ue.Viewer(e,i(i({},{selectionIndicator:!1,showRenderLoopErrors:!1,baseLayerPicker:!1,navigationHelpButton:!1,animation:!1,timeline:!1,shadows:!1,shouldAnimate:!0,infoBox:!1,fullscreenButton:!1,homeButton:!0,geocoder:!1,sceneModePicker:!0,requestRenderMode:!0,scene3DOnly:!1,sceneMode:3}),t));n.imageryLayers.addImageryProvider(new ue.IonImageryProvider({assetId:3})),n.scene.globe.enableLighting=!0,n.scene.debugShowFramesPerSecond=!1,n.camera.setView({destination:ue.Cartesian3.fromDegrees(104,30,1e7),orientation:{heading:ue.Math.toRadians(0),pitch:ue.Math.toRadians(-90),roll:0}}),n.clock.shouldAnimate=!0,window.CViewer=n,(new ue.EventHelper).add(n.scene.globe.tileLoadProgressEvent,(e=>{(e>20||0===e)&&x.done()}))}(),t("mapReady")}))));const o=d((()=>n.modelValue)),r=e=>{t("select",e),t("update:modelValue",e)};return(e,t)=>{const n=N;return g(),M("div",pe,[f(n,{class:"map-select",value:y(o),"onUpdate:value":t[0]||(t[0]=e=>U(o)?o.value=e:null),options:a.value,onChange:r},null,8,["value","options"]),S(e.$slots,"default",{},void 0,!0)])}}}),[["__scopeId","data-v-4f798df4"]]);function me(e){const t=Z(),n=()=>{if(!e||e.scene.mode!==t.SceneMode.SCENE3D)return!1;const n=t.Transforms.computeIcrfToFixedMatrix(e.clock.currentTime);if(t.defined(n)){const a=t.Cartesian3.clone(e.camera.position),o=t.Matrix4.fromRotationTranslation(n);e.camera.lookAtTransform(o,a)}};return{startRotate:t=>{if(e.scene.postUpdate.addEventListener(n),e.clock){const n=Object.keys(t);for(const a of n)e.clock[a]=t[a]}},stopRotate:()=>{e.clock.multiplier=1,e.scene.postUpdate.removeEventListener(n)}}}const ge=[{path:"/",name:"base",component:c({setup(e){const t=F(),n=I("base"),a=I(!1),o=e=>{t.push({name:e})},i=()=>{const{startRotate:e}=me(window.CViewer);e({multiplier:300})};return G((()=>{const{stopRotate:e}=me(window.CViewer);e()})),(e,t)=>{const l=he,r=de;return g(),M(O,null,[f(l,{onSelect:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),onMapReady:i},null,8,["modelValue"]),f(r,{visible:a.value,"onUpdate:visible":t[1]||(t[1]=e=>a.value=e)},null,8,["visible"])],64)}}})},{path:"/osm",name:"osm",component:c({setup(e){const t=F(),n=I("osm"),a=e=>{t.push({name:e})},o=()=>{!function(e){const t=Z();e.imageryLayers.addImageryProvider(new t.IonImageryProvider({assetId:3})),e.scene.primitives.add(t.createOsmBuildings()),e.scene.camera.flyTo({destination:t.Cartesian3.fromDegrees(-74.019,40.6912,750),orientation:{heading:t.Math.toRadians(20),pitch:t.Math.toRadians(-20)}})}(window.CViewer)};return(e,t)=>{const i=he;return g(),p(i,{onSelect:a,onMapReady:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},null,8,["modelValue"])}}})},{path:"/3d-tiles",name:"tile",component:c({setup(e){const t=F(),n=I("tile"),a=e=>{t.push({name:e})},o=()=>{!function(e){l(this,null,(function*(){const t=Z();e.imageryLayers.addImageryProvider(new t.IonImageryProvider({assetId:3}));const n=new t.Cesium3DTileset({url:t.IonResource.fromAssetId(354759)});e.scene.primitives.add(n);try{yield n.readyPromise,yield e.zoomTo(n);const a=n.asset.extras;t.defined(a)&&t.defined(a.ion)&&t.defined(a.ion.defaultStyle)&&(n.style=new t.Cesium3DTileStyle(a.ion.defaultStyle))}catch(a){}}))}(window.CViewer)};return(e,t)=>{const i=he;return g(),p(i,{onSelect:a,onMapReady:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},null,8,["modelValue"])}}})}],fe=W({history:B(),routes:ge}),ye=z(q);ye.use(fe).use(r()).mount("#app"),ye.use(j),ye.config.globalProperties.$message=K;
