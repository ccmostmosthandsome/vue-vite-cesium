var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,i=(e,i)=>{for(var l in i||(i={}))n.call(i,l)&&o(e,l,i[l]);if(t)for(var l of t(i))a.call(i,l)&&o(e,l,i[l]);return e},l=(e,t,n)=>new Promise(((a,o)=>{var i=e=>{try{s(n.next(e))}catch(t){o(t)}},l=e=>{try{s(n.throw(e))}catch(t){o(t)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,l);s((n=n.apply(e,t)).next())}));window.CESIUM_BASE_URL="cesium/";import{c as s,d as r,a as c,b as u,r as d,e as p,w as h,_ as m,o as g,f as y,u as f,S as v,C,h as w,g as I,i as b,j as E,k as S,l as M,m as L,t as T,n as _,F as O,p as P,L as R,q as A,s as D,B as k,v as V,x as H,y as x,z as U,A as N,D as F,E as G,G as W,H as B,I as z}from"./vendor.430beaf6.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const K=s();const j=r({id:"app",state:()=>({pageLoading:!1}),getters:{getPageLoading(){return this.pageLoading}},actions:{setPageLoading(e){this.pageLoading=e}}});const q=c({setup(e){const t=j(),n=u((()=>t.getPageLoading));return(e,t)=>{const a=d("router-view"),o=v,i=m;return g(),p(i,null,{default:h((()=>[y(o,{spinning:f(n),tip:"加载中...",size:"large"},{default:h((()=>[y(a)])),_:1},8,["spinning"])])),_:1})}}});function J(){return i({},C)}const Z=J();function Y(e){const t={};e.cesiumWidget.screenSpaceEventHandler.removeInputAction(Z.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t.handler=new Z.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);const n=[];let a=null,o=0,i=null;t.handler.setInputAction((function(t){const s=e.camera.getPickRay(t.endPosition);i=e.scene.globe.pick(s,e.scene),n.length>=2&&(Z.defined(a)?(n.pop(),n.push(i)):a=new l(n),o=function(e){let t=0;for(let n=0;n<e.length-1;n++){const a=Z.Cartographic.fromCartesian(e[n]),o=Z.Cartographic.fromCartesian(e[n+1]),i=new Z.EllipsoidGeodesic;i.setEndPoints(a,o);let l=i.surfaceDistance;l=Math.sqrt(Math.pow(l,2)+Math.pow(o.height-a.height,2)),t+=l}return Number(t.toFixed(2))}(n))}),Z.ScreenSpaceEventType.MOUSE_MOVE),t.handler.setInputAction((function(a){const l=e.camera.getPickRay(a.position);i=e.scene.globe.pick(l,e.scene),0==n.length&&n.push(i.clone()),n.push(i);const s=o+"米";t.floatingPoint=e.entities.add({name:"空间直线距离",position:n[n.length-1],point:{pixelSize:4,color:Z.Color.RED,outlineColor:Z.Color.WHITE,outlineWidth:2},label:{text:s,font:"18px sans-serif",fillColor:Z.Color.GOLD,style:Z.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:Z.VerticalOrigin.BOTTOM,pixelOffset:new Z.Cartesian2(20,-20)}})}),Z.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(){t.handler.destroy(),n.pop()}),Z.ScreenSpaceEventType.RIGHT_CLICK);const l=function(n){t.options={id:"distancePolyline",name:"直线",polyline:{show:!0,positions:[],material:Z.Color.CHARTREUSE,width:2,clampToGround:!0}},t.positions=n,t.options.polyline.positions=new Z.CallbackProperty((function(){return t.positions}),!1),e.entities.add(t.options)}}const X=J();function $(e){const t={};e.cesiumWidget.screenSpaceEventHandler.removeInputAction(X.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t.handler=new X.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);const n=[],a=[];let o=null,i=null,l=null;const s=[];let r;t.handler.setInputAction((function(t){const a=e.camera.getPickRay(t.endPosition);l=e.scene.globe.pick(a,e.scene),n.length>=2&&(X.defined(o)?(n.pop(),n.push(l)):o=new h(n))}),X.ScreenSpaceEventType.MOUSE_MOVE),t.handler.setInputAction((function(o){const i=e.camera.getPickRay(o.position);l=e.scene.globe.pick(i,e.scene),0==n.length&&n.push(l.clone()),n.push(l);const c=X.Cartographic.fromCartesian(n[n.length-1]),u=X.Math.toDegrees(c.longitude),d=X.Math.toDegrees(c.latitude),p=c.height;a.push({lon:u,lat:d,hei:p}),r=e.entities.add({name:"多边形面积",position:n[n.length-1],point:{pixelSize:5,color:X.Color.RED,outlineColor:X.Color.WHITE,outlineWidth:2,heightReference:X.HeightReference.CLAMP_TO_GROUND}}),s.push(r),t.areapointArray=s}),X.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(){t.handler.destroy(),n.pop();const o=function(e){let t=0;for(let a=0;a<e.length-2;a++){const o=(a+1)%e.length,i=(a+2)%e.length,l=d(e[a],e[o],e[i]);t+=m(n[a],n[o])*m(n[o],n[i])*Math.abs(Math.sin(l))}return(t/1e6).toFixed(4)}(a)+"平方公里";i=e.entities.add({name:"多边形面积",position:n[n.length-1],point:{pixelSize:5,color:X.Color.RED,outlineColor:X.Color.WHITE,outlineWidth:2,heightReference:X.HeightReference.CLAMP_TO_GROUND},label:{text:o,font:"18px sans-serif",fillColor:X.Color.GOLD,style:X.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:X.VerticalOrigin.BOTTOM,pixelOffset:new X.Cartesian2(20,-40),heightReference:X.HeightReference.CLAMP_TO_GROUND}}),s.push(i),t.areapointArray=s}),X.ScreenSpaceEventType.RIGHT_CLICK);const c=Math.PI/180,u=180/Math.PI;function d(e,t,n){let a=p(t,e)-p(t,n);return a<0&&(a+=360),a}function p(e,t){const n=e.lat*c,a=e.lon*c,o=t.lat*c,i=t.lon*c;let l=-Math.atan2(Math.sin(a-i)*Math.cos(o),Math.cos(n)*Math.sin(o)-Math.sin(n)*Math.cos(o)*Math.cos(a-i));return l<0&&(l+=2*Math.PI),l*=u,l}const h=function(n){t.options={id:"areaPolygon",name:"多边形",polygon:{hierarchy:[],material:X.Color.GREEN.withAlpha(.5),heightReference:2e4}},t.hierarchy={positions:n},t.options.polygon.hierarchy=new X.CallbackProperty((function(){return t.hierarchy}),!1),e.entities.add(t.options)};function m(e,t){const n=X.Cartographic.fromCartesian(e),a=X.Cartographic.fromCartesian(t),o=new X.EllipsoidGeodesic;o.setEndPoints(n,a);let i=o.surfaceDistance;return i=Math.sqrt(Math.pow(i,2)+Math.pow(a.height-n.height,2)),i}}const Q=J();function ee(e,t){const n=f([]);let a=f(null),o=f(null);e.scene.globe.depthTestAgainstTerrain=!0,e.cesiumWidget.screenSpaceEventHandler.removeInputAction(Q.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);const i=new Q.ScreenSpaceEventHandler(e.canvas),l=t=>e.entities.add({name:"点",position:t,point:{color:Q.Color.WHITE,pixelSize:10,outlineColor:Q.Color.YELLOW,outlineWidth:3,disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:Q.HeightReference.CLAMP_TO_GROUND}}),s=n=>{let a=null;switch(t){case"polyline":return o=n,a=e.entities.add({name:"线",polyline:{positions:o,clampToGround:!0,width:5}}),a;case"polygon":return a=(t=>e.entities.add({name:"面",polygon:{hierarchy:t,material:new Q.ColorMaterialProperty(Q.Color.WHITE.withAlpha(.7))}}))(n),a;default:return a}var o};i.setInputAction((function(i){const r=e.camera.getPickRay(i.position),c=e.scene.globe.pick(r,e.scene);if(0===n.length){o=l(c),n.push(c);const e=new Q.CallbackProperty((function(){return"polygon"===t?new Q.PolygonHierarchy(n):n}),!1);a=s(e)}l(c),n.push(c)}),Q.ScreenSpaceEventType.LEFT_CLICK),i.setInputAction((function(t){if(Q.defined(o)){const a=e.scene.pickPosition(t.endPosition);Q.defined(a)&&(o.position.setValue(a),n.pop(),n.push(a))}}),Q.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction((function(){r()}),Q.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);const r=()=>{i.destroy(),n.pop(),n.length&&s(n),e.entities.remove(o),e.entities.remove(a),o=null,a=null};i.setInputAction((function(){r()}),Q.ScreenSpaceEventType.RIGHT_CLICK)}const te=J();const ne=J();var ae=(e,t)=>{const n=e.__vccOpts||e;for(const[a,o]of t)n[a]=o;return n};const oe={key:1,class:"panel"},ie={class:"panel-header"},le={class:"content"},se={class:"item-header"},re={class:"content-wrap"};var ce=ae(c({props:{title:{type:String,default:"菜单操作"},width:{type:String,default:"30%"},visible:{type:Boolean,default:!1}},emits:["update:visible","on-click"],setup(e,{emit:t}){const n=e,a=I([{label:"量测",list:[{label:"线距",value:"line"},{label:"面积",value:"area"}]},{label:"绘制",list:[{label:"点",value:"point"},{label:"线",value:"polyline"},{label:"面",value:"polygon"},{label:"清除",value:"clear"}]},{label:"图层",list:[{label:"热力图",value:"heatmap"},{label:"清空热力图",value:"clearHeatmap"}]}]),{removeAllDraw:o}={removeEntities:(e,t)=>{let n=new te.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);if(n&&(n.destroy(),n=null),t&&Array.isArray(t))for(let a=0;a<t.length;a++)e.entities.remove(t[a])},removePrimitives:e=>{e.scene.primitives.removeAll()},removeAllDraw:(e,t=["点","线","面"])=>{const n=e.entities._entities._array;for(let a=n.length-1;a>=0;a--)n[a]._name&&t.includes(n[a]._name)&&e.entities.remove(n[a])}},{createRectangle:i,getRandomData:l,createHeatMap:s}={createRectangle:(e,t,n)=>{e.entities.add({name:"热力图",show:!0,rectangle:{coordinates:ne.Rectangle.fromDegrees(t[0],t[1],t[2],t[3]),material:n._renderer.canvas,transparent:!0}}),e.zoomTo(e.entities)},getRandomData:e=>{const t=[];let n=0;for(;e--;){const e=Math.floor(100*Math.random());n=Math.max(n,e);const a={x:Math.floor(840*Math.random()),y:Math.floor(400*Math.random()),value:e};t.push(a)}return{max:n,data:t}},createHeatMap:(e,t)=>{const n=document.createElement("div");n.setAttribute("style","width: 100px; height: 100px; margin: 0px; display: none;"),document.body.appendChild(n);const a=w.create({container:n,radius:5,maxOpacity:.5,minOpacity:0,gradient:{.9:"red",.8:"orange",.7:"yellow",.5:"blue",.3:"green"}});return a.setData({max:e,data:t}),a}},r=b(!1),c=b(""),d=b(null);E((()=>{r.value=n.visible}));const m=u((()=>r.value?180:0)),v=()=>{r.value=!r.value,t("update:visible",r.value)};return(e,u)=>{const C=k,w=V;return g(),S("div",{class:A(["panel-wrap",{hide:!r.value}])},[e.$slots.default?M(e.$slots,"default",{key:0},void 0,!0):(g(),S("div",oe,[L("header",ie,[L("span",null,T(n.title),1),y(f(_),{onClick:v,class:"close-btn"})]),L("div",le,[(g(!0),S(O,null,P(f(a),((e,n)=>(g(),S("div",{key:n,class:"content-item"},[L("header",se,T(e.label),1),L("div",re,[y(w,null,{default:h((()=>[(g(!0),S(O,null,P(e.list,((e,n)=>(g(),p(C,{size:"small",type:c.value===e.value?"primary":"default",key:n,onClick:n=>(e=>{switch(c.value=e,e){case"line":Y(window.CViewer);break;case"area":$(window.CViewer);break;case"point":case"polyline":case"polygon":ee(window.CViewer,e);break;case"clear":o(window.CViewer),c.value="";break;case"heatmap":const t=[80,22,130,50],{max:n,data:a}=l(200);d.value=s(n,a),i(window.CViewer,t,d.value);break;case"clearHeatmap":o(window.CViewer,["热力图"])}t("on-click",e)})(e.value)},{default:h((()=>[D(T(e.label),1)])),_:2},1032,["type","onClick"])))),128))])),_:2},1024)])])))),128))])])),L("aside",{class:"bar-icon",onClick:v},[y(f(R),{rotate:f(m)},null,8,["rotate"])])],2)}}}),[["__scopeId","data-v-5cf6669b"]]);const ue=J();const de={id:"cesium3DContainer",class:"cesium-3d-container"};var pe=ae(c({props:{modelValue:{type:String,default:"osm"}},emits:["mapReady","select","update:modelValue"],setup(e,{emit:t}){const n=e,a=b([{value:"base",label:"3D map"},{value:"osm",label:"OSM Building"},{value:"tile",label:"3D Tiles"}]);x((()=>l(this,null,(function*(){yield function(e="cesium3DContainer",t){H.start(),ue.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZjgwM2VkMy0wOTQxLTRlMDQtOTA3NC02ZDJhNmFlYWI2M2MiLCJpZCI6OTMyNzEsImlhdCI6MTY1MzYxNTc3MX0.PZXaawvZhCgcahjwZFrmfXRtzvgF5_Vq7S1RtHO0sE8",ue.Camera.DEFAULT_VIEW_RECTANGLE=ue.Rectangle.fromDegrees(80,22,130,50);const n=new ue.Viewer(e,i(i({},{selectionIndicator:!1,showRenderLoopErrors:!1,baseLayerPicker:!1,navigationHelpButton:!1,animation:!1,timeline:!1,shadows:!1,shouldAnimate:!0,infoBox:!1,fullscreenButton:!1,homeButton:!0,geocoder:!1,sceneModePicker:!0,requestRenderMode:!0,scene3DOnly:!1,sceneMode:3}),t));n.imageryLayers.addImageryProvider(new ue.IonImageryProvider({assetId:3})),n.scene.globe.enableLighting=!0,n.scene.debugShowFramesPerSecond=!1,n.camera.setView({destination:ue.Cartesian3.fromDegrees(104,30,1e7),orientation:{heading:ue.Math.toRadians(0),pitch:ue.Math.toRadians(-90),roll:0}}),n.clock.shouldAnimate=!0,window.CViewer=n,(new ue.EventHelper).add(n.scene.globe.tileLoadProgressEvent,(e=>{(e>20||0===e)&&H.done()}))}(),t("mapReady")}))));const o=u((()=>n.modelValue)),s=e=>{t("select",e),t("update:modelValue",e)};return(e,t)=>{const n=N;return g(),S("div",de,[y(n,{class:"map-select",value:f(o),"onUpdate:value":t[0]||(t[0]=e=>U(o)?o.value=e:null),options:a.value,onChange:s},null,8,["value","options"]),M(e.$slots,"default",{},void 0,!0)])}}}),[["__scopeId","data-v-4f798df4"]]);const he=c({setup(e){const t=F(),n=b("base"),a=b(!1),o=e=>{t.push({name:e})};return(e,t)=>{const i=pe,l=ce;return g(),S(O,null,[y(i,{onSelect:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},null,8,["modelValue"]),y(l,{visible:a.value,"onUpdate:visible":t[1]||(t[1]=e=>a.value=e)},null,8,["visible"])],64)}}}),me=J();const ge=c({setup(e){const t=F(),n=b("osm"),a=e=>{t.push({name:e})},o=()=>{var e;(e=window.CViewer).imageryLayers.addImageryProvider(new me.IonImageryProvider({assetId:3})),e.scene.primitives.add(me.createOsmBuildings()),e.scene.camera.flyTo({destination:me.Cartesian3.fromDegrees(-74.019,40.6912,750),orientation:{heading:me.Math.toRadians(20),pitch:me.Math.toRadians(-20)}})};return(e,t)=>{const i=pe;return g(),p(i,{onSelect:a,onMapReady:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},null,8,["modelValue"])}}}),ye=J();const fe=[{path:"/",name:"base",component:he},{path:"/osm",name:"osm",component:ge},{path:"/3d-tiles",name:"tile",component:c({setup(e){const t=F(),n=b("tile"),a=e=>{t.push({name:e})},o=()=>{!function(e){l(this,null,(function*(){e.imageryLayers.addImageryProvider(new ye.IonImageryProvider({assetId:3}));const t=new ye.Cesium3DTileset({url:ye.IonResource.fromAssetId(354759)});e.scene.primitives.add(t);try{yield t.readyPromise,yield e.zoomTo(t);const n=t.asset.extras;ye.defined(n)&&ye.defined(n.ion)&&ye.defined(n.ion.defaultStyle)&&(t.style=new ye.Cesium3DTileStyle(n.ion.defaultStyle))}catch(n){}}))}(window.CViewer)};return(e,t)=>{const i=pe;return g(),p(i,{onSelect:a,onMapReady:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},null,8,["modelValue"])}}})}],ve=G({history:W(),routes:fe}),Ce=B(q);Ce.use(ve).use(s()).mount("#app"),Ce.use(K),Ce.config.globalProperties.$message=z;
