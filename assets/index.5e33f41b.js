var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,r=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))i.call(t,n)&&l(e,n,t[n]);return e},s=(e,t,n)=>new Promise(((a,o)=>{var i=e=>{try{r(n.next(e))}catch(t){o(t)}},l=e=>{try{r(n.throw(e))}catch(t){o(t)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,l);r((n=n.apply(e,t)).next())}));window.CESIUM_BASE_URL="cesium/";import{c,d as u,a as p,b as d,r as h,e as m,w as g,_ as y,o as f,f as v,u as C,S as w,C as b,h as I,g as E,i as S,j as M,k as L,l as T,m as O,t as _,n as P,F as R,p as A,L as D,q as k,s as V,B as H,v as x,x as U,y as N,z as G,A as F,D as W,E as B,G as z,H as K,I as j}from"./vendor.430beaf6.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const q=c();const J=u({id:"app",state:()=>({pageLoading:!1}),getters:{getPageLoading(){return this.pageLoading}},actions:{setPageLoading(e){this.pageLoading=e}}});const Z=p({setup(e){const t=J(),n=d((()=>t.getPageLoading));return(e,t)=>{const a=h("router-view"),o=w,i=y;return f(),m(i,null,{default:g((()=>[v(o,{spinning:C(n),tip:"加载中...",size:"large"},{default:g((()=>[v(a)])),_:1},8,["spinning"])])),_:1})}}});function Y(){return r({},b)}const X=Y();function $(e){const t={};e.cesiumWidget.screenSpaceEventHandler.removeInputAction(X.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t.handler=new X.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);const n=[];let a=null,o=0,i=null;t.handler.setInputAction((function(t){const r=e.camera.getPickRay(t.endPosition);i=e.scene.globe.pick(r,e.scene),n.length>=2&&(X.defined(a)?(n.pop(),n.push(i)):a=new l(n),o=function(e){let t=0;for(let n=0;n<e.length-1;n++){const a=X.Cartographic.fromCartesian(e[n]),o=X.Cartographic.fromCartesian(e[n+1]),i=new X.EllipsoidGeodesic;i.setEndPoints(a,o);let l=i.surfaceDistance;l=Math.sqrt(Math.pow(l,2)+Math.pow(o.height-a.height,2)),t+=l}return Number(t.toFixed(2))}(n))}),X.ScreenSpaceEventType.MOUSE_MOVE),t.handler.setInputAction((function(a){const l=e.camera.getPickRay(a.position);i=e.scene.globe.pick(l,e.scene),0==n.length&&n.push(i.clone()),n.push(i);const r=o+"米";t.floatingPoint=e.entities.add({name:"空间直线距离",position:n[n.length-1],point:{pixelSize:4,color:X.Color.RED,outlineColor:X.Color.WHITE,outlineWidth:2},label:{text:r,font:"18px sans-serif",fillColor:X.Color.GOLD,style:X.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:X.VerticalOrigin.BOTTOM,pixelOffset:new X.Cartesian2(20,-20)}})}),X.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(){t.handler.destroy(),n.pop()}),X.ScreenSpaceEventType.RIGHT_CLICK);const l=function(n){t.options={id:"distancePolyline",name:"直线",polyline:{show:!0,positions:[],material:X.Color.CHARTREUSE,width:2,clampToGround:!0}},t.positions=n,t.options.polyline.positions=new X.CallbackProperty((function(){return t.positions}),!1),e.entities.add(t.options)}}const Q=Y();function ee(e){const t={};e.cesiumWidget.screenSpaceEventHandler.removeInputAction(Q.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t.handler=new Q.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);const n=[],a=[];let o=null,i=null,l=null;const r=[];let s;t.handler.setInputAction((function(t){const a=e.camera.getPickRay(t.endPosition);l=e.scene.globe.pick(a,e.scene),n.length>=2&&(Q.defined(o)?(n.pop(),n.push(l)):o=new h(n))}),Q.ScreenSpaceEventType.MOUSE_MOVE),t.handler.setInputAction((function(o){const i=e.camera.getPickRay(o.position);l=e.scene.globe.pick(i,e.scene),0==n.length&&n.push(l.clone()),n.push(l);const c=Q.Cartographic.fromCartesian(n[n.length-1]),u=Q.Math.toDegrees(c.longitude),p=Q.Math.toDegrees(c.latitude),d=c.height;a.push({lon:u,lat:p,hei:d}),s=e.entities.add({name:"多边形面积",position:n[n.length-1],point:{pixelSize:5,color:Q.Color.RED,outlineColor:Q.Color.WHITE,outlineWidth:2,heightReference:Q.HeightReference.CLAMP_TO_GROUND}}),r.push(s),t.areapointArray=r}),Q.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(){t.handler.destroy(),n.pop();const o=function(e){let t=0;for(let a=0;a<e.length-2;a++){const o=(a+1)%e.length,i=(a+2)%e.length,l=p(e[a],e[o],e[i]);t+=m(n[a],n[o])*m(n[o],n[i])*Math.abs(Math.sin(l))}return(t/1e6).toFixed(4)}(a)+"平方公里";i=e.entities.add({name:"多边形面积",position:n[n.length-1],point:{pixelSize:5,color:Q.Color.RED,outlineColor:Q.Color.WHITE,outlineWidth:2,heightReference:Q.HeightReference.CLAMP_TO_GROUND},label:{text:o,font:"18px sans-serif",fillColor:Q.Color.GOLD,style:Q.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:Q.VerticalOrigin.BOTTOM,pixelOffset:new Q.Cartesian2(20,-40),heightReference:Q.HeightReference.CLAMP_TO_GROUND}}),r.push(i),t.areapointArray=r}),Q.ScreenSpaceEventType.RIGHT_CLICK);const c=Math.PI/180,u=180/Math.PI;function p(e,t,n){let a=d(t,e)-d(t,n);return a<0&&(a+=360),a}function d(e,t){const n=e.lat*c,a=e.lon*c,o=t.lat*c,i=t.lon*c;let l=-Math.atan2(Math.sin(a-i)*Math.cos(o),Math.cos(n)*Math.sin(o)-Math.sin(n)*Math.cos(o)*Math.cos(a-i));return l<0&&(l+=2*Math.PI),l*=u,l}const h=function(n){t.options={id:"areaPolygon",name:"多边形",polygon:{hierarchy:[],material:Q.Color.GREEN.withAlpha(.5),heightReference:2e4}},t.hierarchy={positions:n},t.options.polygon.hierarchy=new Q.CallbackProperty((function(){return t.hierarchy}),!1),e.entities.add(t.options)};function m(e,t){const n=Q.Cartographic.fromCartesian(e),a=Q.Cartographic.fromCartesian(t),o=new Q.EllipsoidGeodesic;o.setEndPoints(n,a);let i=o.surfaceDistance;return i=Math.sqrt(Math.pow(i,2)+Math.pow(a.height-n.height,2)),i}}const te=Y();function ne(e,t){const n=C([]);let a=C(null),o=C(null);e.scene.globe.depthTestAgainstTerrain=!0,e.cesiumWidget.screenSpaceEventHandler.removeInputAction(te.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);const i=new te.ScreenSpaceEventHandler(e.canvas),l=t=>e.entities.add({name:"点",position:t,point:{color:te.Color.WHITE,pixelSize:10,outlineColor:te.Color.YELLOW,outlineWidth:3,disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:te.HeightReference.CLAMP_TO_GROUND}}),r=n=>{let a=null;switch(t){case"polyline":return o=n,a=e.entities.add({name:"线",polyline:{positions:o,clampToGround:!0,width:5}}),a;case"polygon":return a=(t=>e.entities.add({name:"面",polygon:{hierarchy:t,material:new te.ColorMaterialProperty(te.Color.WHITE.withAlpha(.7))}}))(n),a;default:return a}var o};i.setInputAction((function(i){const s=e.camera.getPickRay(i.position),c=e.scene.globe.pick(s,e.scene);if(0===n.length){o=l(c),n.push(c);const e=new te.CallbackProperty((function(){return"polygon"===t?new te.PolygonHierarchy(n):n}),!1);a=r(e)}l(c),n.push(c)}),te.ScreenSpaceEventType.LEFT_CLICK),i.setInputAction((function(t){if(te.defined(o)){const a=e.scene.pickPosition(t.endPosition);te.defined(a)&&(o.position.setValue(a),n.pop(),n.push(a))}}),te.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction((function(){s()}),te.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);const s=()=>{i.destroy(),n.pop(),n.length&&r(n),e.entities.remove(o),e.entities.remove(a),o=null,a=null};i.setInputAction((function(){s()}),te.ScreenSpaceEventType.RIGHT_CLICK)}const ae=Y();const oe=Y();var ie=(e,t)=>{const n=e.__vccOpts||e;for(const[a,o]of t)n[a]=o;return n};const le={key:1,class:"panel"},re={class:"panel-header"},se={class:"content"},ce={class:"item-header"},ue={class:"content-wrap"};var pe=ie(p({props:{title:{type:String,default:"菜单操作"},width:{type:String,default:"30%"},visible:{type:Boolean,default:!1}},emits:["update:visible","on-click"],setup(e,{emit:t}){const n=e,a=E([{label:"量测",list:[{label:"线距",value:"line"},{label:"面积",value:"area"}]},{label:"绘制",list:[{label:"点",value:"point"},{label:"线",value:"polyline"},{label:"面",value:"polygon"},{label:"清除",value:"clear"}]},{label:"图层",list:[{label:"热力图",value:"heatmap"},{label:"清空热力图",value:"clearHeatmap"}]}]),{removeAllDraw:o}={removeEntities:(e,t)=>{let n=new ae.ScreenSpaceEventHandler(e.scene._imageryLayerCollection);if(n&&(n.destroy(),n=null),t&&Array.isArray(t))for(let a=0;a<t.length;a++)e.entities.remove(t[a])},removePrimitives:e=>{e.scene.primitives.removeAll()},removeAllDraw:(e,t=["点","线","面"])=>{const n=e.entities._entities._array;for(let a=n.length-1;a>=0;a--)n[a]._name&&t.includes(n[a]._name)&&e.entities.remove(n[a])}},{createRectangle:i,getRandomData:l,createHeatMap:r}={createRectangle:(e,t,n)=>{e.entities.add({name:"热力图",show:!0,rectangle:{coordinates:oe.Rectangle.fromDegrees(t[0],t[1],t[2],t[3]),material:n._renderer.canvas,transparent:!0}}),e.zoomTo(e.entities)},getRandomData:e=>{const t=[];let n=0;for(;e--;){const e=Math.floor(100*Math.random());n=Math.max(n,e);const a={x:Math.floor(840*Math.random()),y:Math.floor(400*Math.random()),value:e};t.push(a)}return{max:n,data:t}},createHeatMap:(e,t)=>{const n=document.createElement("div");n.setAttribute("style","width: 100px; height: 100px; margin: 0px; display: none;"),document.body.appendChild(n);const a=I.create({container:n,radius:5,maxOpacity:.5,minOpacity:0,gradient:{.9:"red",.8:"orange",.7:"yellow",.5:"blue",.3:"green"}});return a.setData({max:e,data:t}),a}},s=S(!1),c=S(""),u=S(null);M((()=>{s.value=n.visible}));const p=d((()=>s.value?180:0)),h=()=>{s.value=!s.value,t("update:visible",s.value)};return(e,d)=>{const y=H,w=x;return f(),L("div",{class:k(["panel-wrap",{hide:!s.value}])},[e.$slots.default?T(e.$slots,"default",{key:0},void 0,!0):(f(),L("div",le,[O("header",re,[O("span",null,_(n.title),1),v(C(P),{onClick:h,class:"close-btn"})]),O("div",se,[(f(!0),L(R,null,A(C(a),((e,n)=>(f(),L("div",{key:n,class:"content-item"},[O("header",ce,_(e.label),1),O("div",ue,[v(w,null,{default:g((()=>[(f(!0),L(R,null,A(e.list,((e,n)=>(f(),m(y,{size:"small",type:c.value===e.value?"primary":"default",key:n,onClick:n=>(e=>{switch(c.value=e,e){case"line":$(window.CViewer);break;case"area":ee(window.CViewer);break;case"point":case"polyline":case"polygon":ne(window.CViewer,e);break;case"clear":o(window.CViewer),c.value="";break;case"heatmap":const t=[80,22,130,50],{max:n,data:a}=l(200);u.value=r(n,a),i(window.CViewer,t,u.value);break;case"clearHeatmap":o(window.CViewer,["热力图"])}t("on-click",e)})(e.value)},{default:g((()=>[V(_(e.label),1)])),_:2},1032,["type","onClick"])))),128))])),_:2},1024)])])))),128))])])),O("aside",{class:"bar-icon",onClick:h},[v(C(D),{rotate:C(p)},null,8,["rotate"])])],2)}}}),[["__scopeId","data-v-5cf6669b"]]);const de=Y();function he(e="cesium3DContainer",a){U.start(),de.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZjgwM2VkMy0wOTQxLTRlMDQtOTA3NC02ZDJhNmFlYWI2M2MiLCJpZCI6OTMyNzEsImlhdCI6MTY1MzYxNTc3MX0.PZXaawvZhCgcahjwZFrmfXRtzvgF5_Vq7S1RtHO0sE8",de.Camera.DEFAULT_VIEW_RECTANGLE=de.Rectangle.fromDegrees(80,22,130,50);const o=new de.Viewer(e,(i=r(r({},{selectionIndicator:!1,showRenderLoopErrors:!1,baseLayerPicker:!1,navigationHelpButton:!1,animation:!1,timeline:!1,shadows:!1,shouldAnimate:!0,infoBox:!1,fullscreenButton:!1,homeButton:!0,geocoder:!1,sceneModePicker:!0,requestRenderMode:!0,scene3DOnly:!1,sceneMode:3}),a),l={imageryProvider:new de.ArcGisMapServerImageryProvider({url:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer"})},t(i,n(l))));var i,l;o.scene.globe.enableLighting=!0,o.scene.debugShowFramesPerSecond=!1,o.camera.setView({destination:de.Cartesian3.fromDegrees(104,30,1e7),orientation:{heading:de.Math.toRadians(0),pitch:de.Math.toRadians(-90),roll:0}}),o.clock.shouldAnimate=!0,window.CViewer=o;(new de.EventHelper).add(o.scene.globe.tileLoadProgressEvent,(e=>{(e>20||0===e)&&U.done()}))}const me={id:"cesium3DContainer",class:"cesium-3d-container"};var ge=ie(p({props:{modelValue:{type:String,default:"osm"}},emits:["mapReady","select","update:modelValue"],setup(e,{emit:t}){const n=e,a=S([{value:"base",label:"3D map"},{value:"osm",label:"OSM Building"},{value:"tile",label:"3D Tiles"}]);N((()=>s(this,null,(function*(){yield he(),t("mapReady")}))));const o=d((()=>n.modelValue)),i=e=>{t("select",e),t("update:modelValue",e)};return(e,t)=>{const n=F;return f(),L("div",me,[v(n,{class:"map-select",value:C(o),"onUpdate:value":t[0]||(t[0]=e=>G(o)?o.value=e:null),options:a.value,onChange:i},null,8,["value","options"]),T(e.$slots,"default",{},void 0,!0)])}}}),[["__scopeId","data-v-4f798df4"]]);const ye=p({setup(e){const t=W(),n=S("base"),a=S(!1),o=e=>{t.push({name:e})};return(e,t)=>{const i=ge,l=pe;return f(),L(R,null,[v(i,{onSelect:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},null,8,["modelValue"]),v(l,{visible:a.value,"onUpdate:visible":t[1]||(t[1]=e=>a.value=e)},null,8,["visible"])],64)}}}),fe=Y();const ve=p({setup(e){const t=W(),n=S("osm"),a=e=>{t.push({name:e})},o=()=>{var e;(e=window.CViewer).imageryLayers.addImageryProvider(new fe.IonImageryProvider({assetId:3})),e.scene.primitives.add(fe.createOsmBuildings()),e.scene.camera.flyTo({destination:fe.Cartesian3.fromDegrees(-74.019,40.6912,750),orientation:{heading:fe.Math.toRadians(20),pitch:fe.Math.toRadians(-20)}})};return(e,t)=>{const i=ge;return f(),m(i,{onSelect:a,onMapReady:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},null,8,["modelValue"])}}}),Ce=Y();const we=[{path:"/",name:"base",component:ye},{path:"/osm",name:"osm",component:ve},{path:"/3d-tiles",name:"tile",component:p({setup(e){const t=W(),n=S("tile"),a=e=>{t.push({name:e})},o=()=>{!function(e){s(this,null,(function*(){e.imageryLayers.addImageryProvider(new Ce.IonImageryProvider({assetId:3}));const t=new Ce.Cesium3DTileset({url:Ce.IonResource.fromAssetId(354759)});e.scene.primitives.add(t);try{yield t.readyPromise,yield e.zoomTo(t);const n=t.asset.extras;Ce.defined(n)&&Ce.defined(n.ion)&&Ce.defined(n.ion.defaultStyle)&&(t.style=new Ce.Cesium3DTileStyle(n.ion.defaultStyle))}catch(n){}}))}(window.CViewer)};return(e,t)=>{const i=ge;return f(),m(i,{onSelect:a,onMapReady:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e)},null,8,["modelValue"])}}})}],be=B({history:z(),routes:we}),Ie=K(Z);Ie.use(be).use(c()).mount("#app"),Ie.use(q),Ie.config.globalProperties.$message=j;
